$theme-dark: (
  color-scheme: dark,
  bg: #0b0d12,
  surface-panel: #101724,
  surface-card: #141c2a,
  card: #141c2a,
  surface-ghost: #1c2636,
  stroke: #1f2a3c,
  bd: #243042,
  border-soft: #243042,
  border-strong: #31405a,
  accent: #5aa9ff,
  accent-soft: #93c5fd,
  ink: #f8fafc,
  muted: #b8c3d5,
  hero-background: unquote("linear-gradient(135deg, rgba(59,130,246,0.22), rgba(59,130,246,0.05)), linear-gradient(180deg, rgba(15,23,42,0.9), rgba(15,23,42,0.72))"),
  hero-border: #3b82f6,
  chip-bg: #16243a,
  chip-border: #243a5f,
  chip-ink: #f1f5ff,
  step-bg: #101a2a,
  step-border: #223551,
  step-icon-bg: rgba(90,169,255,0.24),
  metric-bg: #101a2a,
  metric-border: #223551,
  metric-shadow: 0 18px 32px rgba(4,8,20,0.45),
  shadow-card: 0 24px 48px rgba(4,8,20,0.45),
  shadow-flat: none,
  tone-ok-bg: #123829,
  tone-ok-fg: #63f0a5,
  tone-ok-border: #1f6141,
  tone-warn-bg: #3f2a0f,
  tone-warn-fg: #f2c057,
  tone-warn-border: #7a5b1f,
  tone-risk-bg: #3d1518,
  tone-risk-fg: #f18882,
  tone-risk-border: #7a2b36,
  badge-ok: #2dd4bf,
  badge-warn: #f59e0b,
  badge-risk: #fb7185,
  pill-bg: transparent
);

$theme-dark-high-contrast: map-merge(
  $theme-dark,
  (
    bg: #010409,
    surface-panel: #060b14,
    surface-card: #0a1220,
    card: #0a1220,
    surface-ghost: #0f1b2c,
    stroke: #3b82f6,
    bd: #3b82f6,
    border-soft: #3b82f6,
    border-strong: #60a5fa,
    accent: #1ea7ff,
    accent-soft: #82d3ff,
    ink: #ffffff,
    muted: #dbe6ff,
    metric-shadow: none,
    shadow-card: none,
    tone-ok-bg: #083d2b,
    tone-ok-fg: #7fffd4,
    tone-ok-border: #34d399,
    tone-warn-bg: #4a2a00,
    tone-warn-fg: #fbbf24,
    tone-warn-border: #f59e0b,
    tone-risk-bg: #470011,
    tone-risk-fg: #ff7b89,
    tone-risk-border: #fb7185,
    badge-ok: #34d399,
    badge-warn: #f59e0b,
    badge-risk: #fb7185
  )
);

$theme-light: (
  color-scheme: light,
  bg: #f4f7fb,
  surface-panel: #ffffff,
  surface-card: #ffffff,
  card: #ffffff,
  surface-ghost: #eef2ff,
  stroke: #d7def1,
  bd: #cfd7ef,
  border-soft: #cfd7ef,
  border-strong: #94a3b8,
  accent: #2563eb,
  accent-soft: #93c5fd,
  ink: #0f172a,
  muted: #4a5a7d,
  hero-background: unquote("linear-gradient(135deg, rgba(96,165,250,0.25), rgba(96,165,250,0.05)), linear-gradient(180deg, rgba(255,255,255,0.9), rgba(236,244,255,0.78))"),
  hero-border: #60a5fa,
  chip-bg: #e2e8f9,
  chip-border: #c3d4fb,
  chip-ink: #1e293b,
  step-bg: #e9effd,
  step-border: #c3d4fb,
  step-icon-bg: rgba(37,99,235,0.18),
  metric-bg: #f1f4fc,
  metric-border: #cbd5f5,
  metric-shadow: 0 16px 32px rgba(15,23,42,0.1),
  shadow-card: 0 24px 48px rgba(15,23,42,0.12),
  shadow-flat: none,
  tone-ok-bg: #c6f6d5,
  tone-ok-fg: #1f5136,
  tone-ok-border: #38a169,
  tone-warn-bg: #fef3c7,
  tone-warn-fg: #854d0e,
  tone-warn-border: #f59e0b,
  tone-risk-bg: #fee2e2,
  tone-risk-fg: #991b1b,
  tone-risk-border: #f87171,
  badge-ok: #047857,
  badge-warn: #c2410c,
  badge-risk: #dc2626,
  pill-bg: transparent
);

$theme-light-high-contrast: map-merge(
  $theme-light,
  (
    bg: #ffffff,
    surface-panel: #f5faff,
    surface-card: #f5faff,
    card: #f5faff,
    surface-ghost: #e2ecff,
    stroke: #1e40af,
    bd: #1d4ed8,
    border-soft: #1d4ed8,
    border-strong: #1d4ed8,
    accent: #0f4cd6,
    accent-soft: #5f8dff,
    ink: #0b1526,
    muted: #1f2937,
    chip-bg: #e0ecff,
    chip-border: #1d4ed8,
    chip-ink: #0f172a,
    step-icon-bg: rgba(15,76,214,0.16),
    metric-shadow: none,
    shadow-card: none,
    tone-ok-bg: #bbf7d0,
    tone-ok-fg: #166534,
    tone-ok-border: #15803d,
    tone-warn-bg: #fde68a,
    tone-warn-fg: #92400e,
    tone-warn-border: #b45309,
    tone-risk-bg: #fecaca,
    tone-risk-fg: #7f1d1d,
    tone-risk-border: #b91c1c,
    badge-ok: #15803d,
    badge-warn: #b45309,
    badge-risk: #b91c1c
  )
);

$theme-solarized: (
  color-scheme: light,
  bg: #fdf6e3,
  surface-panel: #fefbf3,
  surface-card: #fefcf6,
  card: #fefcf6,
  surface-ghost: #f2e5c7,
  stroke: #e7dcbf,
  bd: #d9caa6,
  border-soft: #d9caa6,
  border-strong: #b5a273,
  accent: #268bd2,
  accent-soft: #2aa198,
  ink: #073642,
  muted: #596a72,
  hero-background: unquote("linear-gradient(135deg, rgba(38,139,210,0.2), rgba(38,139,210,0.05)), linear-gradient(180deg, rgba(253,246,227,0.92), rgba(249,240,213,0.78))"),
  hero-border: #268bd2,
  chip-bg: #ece3c5,
  chip-border: #d7c69a,
  chip-ink: #073642,
  step-bg: #f2e7c9,
  step-border: #d7c69a,
  step-icon-bg: rgba(38,139,210,0.18),
  metric-bg: #f5ebd3,
  metric-border: #d7c69a,
  metric-shadow: 0 12px 24px rgba(7,54,66,0.12),
  shadow-card: 0 20px 36px rgba(7,54,66,0.18),
  shadow-flat: none,
  tone-ok-bg: #c8f1dc,
  tone-ok-fg: #1d5c3a,
  tone-ok-border: #3a9d6a,
  tone-warn-bg: #fee6b4,
  tone-warn-fg: #7c5416,
  tone-warn-border: #d48b1f,
  tone-risk-bg: #f9c0c0,
  tone-risk-fg: #8f1d2d,
  tone-risk-border: #d2565d,
  badge-ok: #2aa198,
  badge-warn: #cb4b16,
  badge-risk: #dc322f,
  pill-bg: transparent
);

$themes: (
  dark: $theme-dark,
  "dark-high-contrast": $theme-dark-high-contrast,
  light: $theme-light,
  "light-high-contrast": $theme-light-high-contrast,
  solarized: $theme-solarized
);

$font-scales: (
  base: 1,
  large: 1.12,
  xlarge: 1.24
);

$colorblind-safe: (
  accent: #0f7fb0,
  accent-soft: #5cb6d8,
  badge-ok: #20897a,
  badge-warn: #d9822b,
  badge-risk: #c4476d,
  tone-ok-bg: #1b4d3a,
  tone-ok-fg: #a4e9c0,
  tone-ok-border: #2c7a58,
  tone-warn-bg: #4a3b16,
  tone-warn-fg: #f2c14e,
  tone-warn-border: #b98020,
  tone-risk-bg: #4a2633,
  tone-risk-fg: #f29cb5,
  tone-risk-border: #a8516e
);

$colorblind-modes: (
  normal: (),
  safe: $colorblind-safe
);

@mixin emit-token-map($map) {
  @each $key, $value in $map {
    @if $key == color-scheme {
      color-scheme: #{$value};
    } @else {
      --#{$key}: #{$value};
    }
  }
}

:root {
  @include emit-token-map(map-get($themes, dark));
}

body {
  --font-scale: 1;
}

@each $theme-name, $tokens in $themes {
  body[data-rexai-theme="#{$theme-name}"],
  .stApp[data-rexai-theme="#{$theme-name}"] {
    @include emit-token-map($tokens);
  }
}

@each $size, $scale in $font-scales {
  body[data-rexai-font="#{$size}"],
  .stApp[data-rexai-font="#{$size}"] {
    --font-scale: #{$scale};
  }
}

@each $mode, $tokens in $colorblind-modes {
  @if length($tokens) > 0 {
    body[data-rexai-colorblind="#{$mode}"],
    .stApp[data-rexai-colorblind="#{$mode}"] {
      @include emit-token-map($tokens);
    }
  }
}
